@if (mode$ | async; as mode) {
  <div class="controls-panel">
    <div class="button-group">
      <button 
        [class.active]="mode === 'draw'"
        (click)="setMode('draw')">
        <span class="button-icon pencil-icon"></span>
        Draw Map
      </button>
      
      <button 
        [class.active]="mode === 'erase'"
        (click)="setMode('erase')"
        title="Erase walls and remove waypoints">
        <span class="button-icon eraser-icon"></span>
        Eraser
      </button>
      
      <button 
        [class.active]="mode === 'set_points'"
        (click)="setMode('set_points')">
        <span class="button-icon flag-icon"></span>
        Set Points
      </button>
      
      <button 
        [class.active]="mode === 'find_path'"
        (click)="findPath()"
        [disabled]="isCalculating">
        {{ isCalculating ? 'Calculating...' : 'Find Path' }}
      </button>
      
      <button 
        (click)="findCameraPoses()"
        [disabled]="isCalculatingCameras">
        {{ isCalculatingCameras ? 'Calculating...' : 'Cam Poses' }}
      </button>
      
      <button 
        class="clear-btn"
        (click)="clearCameras()">
        Clear Cameras
      </button>
      
      <button 
        (click)="replayAnimation()">
        Replay
      </button>
      
      <button 
        class="clear-btn"
        (click)="clearWaypoints()">
        Clear Waypoints
      </button>
    </div>

    <div class="map-management">
      <div class="input-group">
        <input 
          type="text" 
          [(ngModel)]="mapName" 
          placeholder="Map name (optional)"
          (keyup.enter)="saveCurrentMap()">
        <button (click)="saveCurrentMap()" [disabled]="isCalculating">Save Map</button>
      </div>
      
      <div class="open-map-container">
        <button (click)="showOpenDialog = !showOpenDialog">
          {{ showOpenDialog ? 'Close' : 'Open Saved Map' }}
        </button>
        
        @if (showOpenDialog) {
          <div class="saved-maps-list">
            @if (savedMaps.length === 0) {
              <div class="no-maps">No saved maps found</div>
            } @else {
              @for (map of savedMaps; track map.id) {
                <div class="map-item" (click)="openMap(map)">
                  <span class="map-name">{{ map.name }}</span>
                  <button class="delete-btn" (click)="deleteMap(map.id, $event)">Ã—</button>
                </div>
              }
            }
          </div>
        }
      </div>
    </div>
    
    <div class="options">
      <label class="checkbox-label">
        <input 
          type="checkbox" 
          [checked]="(optimizeOrder$ | async) || false"
          (change)="toggleOptimizeOrder()">
        <span>Optimize Waypoint Order</span>
      </label>
      
      <select [disabled]="!(optimizeOrder$ | async)"
          class="strategy-select"
          [value]="(optimizationStrategy$ | async) || 'strategy1'"
          (change)="setOptimizationStrategy($event)">
          <option value="strategy1">Strategy 1 (Fast)</option>
          <option value="strategy2">Strategy 2 (Accurate)</option>
        </select>

      <div class="camera-controls">
        <label class="range-label">
          <span>Camera Range: {{ (cameraRange$ | async) || 20 }} cells</span>
          <input 
            type="range" 
            min="8" 
            max="40" 
            [value]="(cameraRange$ | async) || 20"
            (input)="setCameraRange($event)"
            class="range-input">
        </label>
      </div>
    </div>
  </div>
}
