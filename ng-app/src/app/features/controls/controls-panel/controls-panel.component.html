<div class="controls-panel">
  <div class="button-group">
    <button
      [class.active]="mode() === 'draw'"
      (click)="setMode('draw')">
      <span class="button-icon pencil-icon"></span>
      Draw Map
    </button>

    <button
      [class.active]="mode() === 'erase'"
      (click)="setMode('erase')"
      title="Erase walls and remove waypoints">
      <span class="button-icon eraser-icon"></span>
      Eraser
    </button>

    <button
      [class.active]="mode() === 'set_points'"
      (click)="setMode('set_points')">
      <span class="button-icon flag-icon"></span>
      Set Points
    </button>

    <button
      [class.active]="mode() === 'find_path'"
      (click)="findPath()"
      [disabled]="isCalculating()">
      {{ isCalculating() ? 'Calculating...' : 'Find Path' }}
    </button>

    <button
      (click)="findCameraPoses()"
      [disabled]="isCalculatingCameras()">
      {{ isCalculatingCameras() ? 'Calculating...' : 'Cam Poses' }}
    </button>

    <button
      class="clear-btn"
      (click)="clearCameras()">
      Clear Cameras
    </button>

    <button
      (click)="replayAnimation()">
      Replay
    </button>

    <button
      class="clear-btn"
      (click)="clearWaypoints()">
      Clear Waypoints
    </button>
  </div>

  <div class="map-management">
    @if (currentMapId()) {
      <div class="editing-indicator">Editing: {{ mapName() || 'Untitled' }}</div>
    }
    <div class="input-group">
      <input
        type="text"
        [ngModel]="mapName()"
        (ngModelChange)="updateMapName($event)"
        [placeholder]="currentMapId() ? 'Map name' : 'Map name (optional)'"
        (keyup.enter)="saveCurrentMap()">
      <button (click)="saveCurrentMap()" [disabled]="isCalculating()">
        {{ currentMapId() ? 'Update Map' : 'Save Map' }}
      </button>
    </div>

    <div class="open-map-container">
      <button (click)="toggleOpenDialog()">
        {{ showOpenDialog() ? 'Close' : 'Open Saved Map' }}
      </button>

      @if (showOpenDialog()) {
        <div class="saved-maps-list">
          @if (savedMaps().length === 0) {
            <div class="no-maps">No saved maps found</div>
          } @else {
            @for (map of savedMaps(); track map.id) {
              <div class="map-item" (click)="openMap(map)">
                <span class="map-name">{{ map.name }}</span>
                <button class="delete-btn" (click)="deleteMap(map.id, $event)">×</button>
              </div>
            }
          }
        </div>
      }
    </div>
  </div>

  <div class="options">
    <label class="checkbox-label">
      <input
        type="checkbox"
        [checked]="optimizeOrder()"
        (change)="toggleOptimizeOrder()">
      <span>Optimize Waypoint Order</span>
    </label>

    <select [disabled]="!optimizeOrder()"
        class="strategy-select"
        [value]="optimizationStrategy()"
        (change)="setOptimizationStrategy($event)">
        <option value="strategy1">Strategy 1 (Fast)</option>
        <option value="strategy2">Strategy 2 (Accurate)</option>
      </select>

    <div class="camera-controls">
      <label class="range-label">
        <span>Camera Range: {{ cameraRange() }} cells</span>
        <input
          type="range"
          min="8"
          max="40"
          [value]="cameraRange()"
          (input)="setCameraRange($event)"
          class="range-input">
      </label>
    </div>
  </div>

  <div class="auto-nav-section">
    <h3>Auto Navigation</h3>
    <button
      [class.active]="autoNavService.isActive()"
      (click)="toggleAutoNav()">
      {{ autoNavService.isActive() ? 'Stop Auto Nav' : 'Start Auto Nav' }}
    </button>

    <div class="auto-nav-params" [class.disabled]="autoNavService.isActive()">
      <div class="param-row">
        <span>Scan Range:</span>
        <input type="number" [ngModel]="autoNavService.scanRange()" (ngModelChange)="updateAutoNavParam('scanRange', $event)" min="10" max="200">
      </div>
      <div class="param-row">
        <span>Bin Size (°):</span>
        <input type="number" [ngModel]="autoNavService.binSize()" (ngModelChange)="updateAutoNavParam('binSize', $event)" min="10" max="90" step="10">
      </div>
      <div class="param-row">
        <span>Scan Radius:</span>
        <input type="number" [ngModel]="autoNavService.scannedRadius()" (ngModelChange)="updateAutoNavParam('scannedRadius', $event)" min="5" max="30">
      </div>
      <div class="param-row">
        <span>Speed:</span>
        <input type="number" [ngModel]="autoNavService.speed()" (ngModelChange)="updateAutoNavParam('speed', $event)" min="1" max="50">
      </div>
      <div class="param-row">
        <span>Wall Gap:</span>
        <input type="number" [ngModel]="autoNavService.wallGap()" (ngModelChange)="updateAutoNavParam('wallGap', $event)" min="0" max="10">
      </div>
      <div class="param-row">
        <span>Peer Gap:</span>
        <input type="number" [ngModel]="autoNavService.peerGap()" (ngModelChange)="updateAutoNavParam('peerGap', $event)" min="1" max="20">
      </div>
      <div class="param-row">
        <span>Redundancy (%):</span>
        <input type="number" [ngModel]="autoNavService.redundancyThreshold() * 100" (ngModelChange)="updateAutoNavParam('redundancyThreshold', $event / 100)" min="0" max="100" step="5">
      </div>
    </div>
  </div>
</div>
